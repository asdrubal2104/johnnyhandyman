---
import { Plus, Minus } from "@lucide/astro";

const { faqs = [] } = Astro.props;

const defaultFaqs = [
  {
    question: "What areas do you serve in Utah?",
    answer:
      "We primarily serve Ogden and the greater Weber County area, including South Ogden, North Ogden, and Riverdale. We also cover surrounding areas like Salt Lake City and Layton for larger projects. Call to confirm availability.",
  },
  {
    question: "How quickly can you respond to service requests?",
    answer:
      "We aim to respond to all inquiries within 24 hours. For urgent repairs, we often have same-day availability. Emergency services can frequently be scheduled within a few hours.",
  },
  {
    question: "Are you licensed and insured?",
    answer:
      "Yes, Johnny Pro Handyman Services is fully licensed and insured. We carry comprehensive liability insurance for your peace of mind and protection.",
  },
  {
    question: "Do you provide estimates?",
    answer:
      "Absolutely. We provide transparent estimates for every project. We'll assess your needs and give you a detailed quote before starting any work.",
  },
  {
    question: "What types of payment do you accept?",
    answer:
      "We accept cash, checks, major credit cards, and digital payments. Payment is generally due upon completion, and you'll receive a detailed invoice.",
  },
  {
    question: "What is your warranty policy?",
    answer:
      "We stand behind our work with a satisfaction guarantee. If you're not happy, we'll make it right. Specific warranties vary by project and will be clearly explained upfront.",
  },
  {
    question: "Can you handle both small repairs and large projects?",
    answer:
      "Yes! We handle everything from minor repairs—like a leaky faucet—to larger renovations. No job is too small or too big for our team.",
  },
  {
    question: "Do I need to provide materials, or do you supply them?",
    answer:
      "We can work either way. We're happy to use materials you've already purchased, or we can source high-quality materials for you. We'll find the best solution during your estimate.",
  },
];

const faqList = faqs.length > 0 ? faqs : defaultFaqs;
---

<section class="py-20 bg-black faq-section">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-16" data-animate-faq-header>
      <h2 class="text-4xl md:text-5xl font-bold text-white mb-4 font-inter">
        Frequently Asked <span class="text-orange-500">Questions</span>
      </h2>
      <p class="text-xl text-gray-400">
        Get answers to common questions about our handyman services
      </p>
    </div>

    <div class="space-y-4" data-faq-container>
      {
        faqList.map(
          (faq: { question: string; answer: string }, index: number) => (
            <div
              class="bg-gray-900/50 border border-white/10 rounded-xl overflow-hidden hover:border-orange-500/50 transition-all"
              data-faq-item
              data-index={index}
            >
              <button
                class="w-full px-6 py-5 flex items-center justify-between text-left group"
                data-faq-button
                aria-expanded="false"
              >
                <span class="text-lg font-semibold text-white group-hover:text-orange-500 transition-colors pr-4">
                  {faq.question}
                </span>
                <div class="shrink-0">
                  <Plus
                    class="w-6 h-6 text-orange-500 transition-transform"
                    data-icon-plus
                  />
                  <Minus
                    class="w-6 h-6 text-orange-500 hidden transition-transform"
                    data-icon-minus
                  />
                </div>
              </button>

              <div
                class="overflow-hidden transition-all duration-300 max-h-0"
                data-faq-answer
              >
                <div class="px-6 pb-5 text-gray-300 leading-relaxed">
                  {faq.answer}
                </div>
              </div>
            </div>
          ),
        )
      }
    </div>
  </div>
</section>

<style>
  [data-animate-faq-header],
  [data-faq-item] {
    opacity: 0;
    transform: translateY(20px);
    visibility: visible;
    transition:
      opacity 0.6s cubic-bezier(0.2, 0.8, 0.2, 1),
      transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
  }

  .reveal-active[data-animate-faq-header],
  .reveal-active[data-faq-item] {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  import gsap from "gsap";

  function setupFAQ() {
    document.querySelectorAll(".faq-section").forEach((section) => {
      const container = section.querySelector("[data-faq-container]");
      const header = section.querySelector("[data-animate-faq-header]");

      if (!container || !header) return;

      const items = container.querySelectorAll("[data-faq-item]");

      // Setup toggle logic
      items.forEach((item) => {
        const button = item.querySelector("[data-faq-button]");
        const answer = item.querySelector("[data-faq-answer]");
        const iconPlus = item.querySelector("[data-icon-plus]");
        const iconMinus = item.querySelector("[data-icon-minus]");

        if (!button || !answer || !iconPlus || !iconMinus) return;

        const clonedButton = button.cloneNode(true);
        button.replaceWith(clonedButton);
        const newButton = clonedButton as HTMLElement;

        newButton.addEventListener("click", () => {
          const isOpen = newButton.getAttribute("aria-expanded") === "true";

          // Close others
          items.forEach((otherItem) => {
            if (otherItem !== item) {
              const otherBtn = otherItem.querySelector("[data-faq-button]");
              const otherAns = otherItem.querySelector("[data-faq-answer]");
              if (
                otherBtn &&
                otherAns &&
                otherBtn.getAttribute("aria-expanded") === "true"
              ) {
                otherBtn.setAttribute("aria-expanded", "false");
                gsap.to(otherAns, {
                  maxHeight: 0,
                  duration: 0.25,
                  ease: "power2.inOut",
                });
                otherItem
                  .querySelector("[data-icon-plus]")
                  ?.classList.remove("hidden");
                otherItem
                  .querySelector("[data-icon-minus]")
                  ?.classList.add("hidden");
              }
            }
          });

          if (isOpen) {
            newButton.setAttribute("aria-expanded", "false");
            gsap.to(answer, {
              maxHeight: 0,
              duration: 0.25,
              ease: "power2.inOut",
            });
            iconPlus.classList.remove("hidden");
            iconMinus.classList.add("hidden");
          } else {
            newButton.setAttribute("aria-expanded", "true");
            gsap.to(answer, {
              maxHeight: (answer as HTMLElement).scrollHeight,
              duration: 0.25,
              ease: "power2.inOut",
            });
            iconPlus.classList.add("hidden");
            iconMinus.classList.remove("hidden");
          }
        });
      });

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              if (entry.target.hasAttribute("data-animate-faq-header")) {
                entry.target.classList.add("reveal-active");
              } else {
                const items = entry.target.querySelectorAll("[data-faq-item]");
                items.forEach((item, i) => {
                  setTimeout(() => item.classList.add("reveal-active"), i * 50);
                });
              }
              observer.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.1 },
      );

      observer.observe(header);
      observer.observe(container);
    });
  }

  setupFAQ();
  document.addEventListener("astro:page-load", setupFAQ);
</script>
